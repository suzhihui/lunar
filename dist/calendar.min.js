!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).lunar=e()}(this,function(){"use strict";function t(t,e){for(var a in void 0===e&&(e=[]),this.options=t,this.solarMonth=e,this.defaults={monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["周日","周一","周二","周三","周四","周五","周六"],dayLongNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],holiday:{"1-1":"元旦","2-2":"湿地日","2-14":"情人节","3-8":"妇女节","3-12":"植树节","3-15":"消费者权益日","4-1":"愚人节","4-22":"地球日","5-1":"劳动节","5-4":"青年节","5-12":"护士节","5-18":"博物馆日","6-1":"儿童节","6-5":"环境日","6-23":"奥林匹克日","6-24":"骨质疏松日","7-1":"建党节","8-1":"建军节","9-3":"抗战胜利日","9-10":"教师节","10-1":"国庆节","11-17":"学生日","12-1":"艾滋病日","12-24":"平安夜","12-25":"圣诞节"},firstDay:1,weekendDays:[0,6],dateFormat:"yyyy-mm-dd"},this.firstWeek=1,this.length=0,t=t||{},this.defaults)void 0===t[a]&&(t[a]=this.defaults[a]);this.solarMonth=[31,28,31,30,31,30,31,31,30,31,30,31],this.attrs=t}return t.prototype.solarDays=function(t,e){return 1==e?t%4==0&&t%100!=0||t%400==0?29:28:this.solarMonth[e]},t.prototype.getLunarCalendar=function(t,i,e){var s=this,a=["初","十","廿","三"],r=["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","露水","秋分","寒露","霜降","立冬","小雪","大雪","冬至"],o=t-1900,n=2*i-1,l=(i-1+12)%12,u="",h="",f=this._gregorianCalendarToAccumulateDate(t,i,e),c=this._getLunarDate(f),g=this._getLunarDate(this._getSolarTermAccumulateDate(o,n)),m=this._getLunarDate(this._getSolarTermAccumulateDate(o,2+n)),d=this._getSolarTermAccumulateDate(o,n),y=this._getSolarTermAccumulateDate(o,2+n),D=this._getSolarTermAccumulateDate(o,n-1),p=this._getSolarTermAccumulateDate(o,1+n),v=new Date(t+"-"+i+"-1");this.length=this.solarDays(t,i),this.firstWeek=v.getDay(),f<d&&c+d-f!==g?l--:d<f&&c-(f-d)!==g&&c+m-f===y&&l++,d===f?u=r[n]:D===f?u=r[n-1]:p===f&&(u=r[1+n]);var _=0==l?1:l;h=_<10?"0"+_:_+"",h+=c<10?"0"+c:c,console.log(h,"**",l,"---",c);var M={"0101":"春节","0115":"元宵节","0202":"龙头节","0505":"端午","0707":"七夕","0715":"中元节","0815":"中秋","0909":"重阳节",1001:"寒衣节",1015:"下元节",1208:"腊八节",1223:"小年",1230:"除夕"}[h],A=["正月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","腊月"][(_+11)%12],T=Math.floor((c-1)/10),S=20===c||30===c?a[T+1]:a[T];return S+=["十","一","二","三","四","五","六","七","八","九"][c%10],["0520 母亲节","0630 父亲节","1144 感恩节"].forEach(function(t){if(t.match(/^(\d{2})(\d)(\d)([\s\*])(.+)$/)&&Number(RegExp.$1)==i){var e=Number(RegExp.$2),a=Number(RegExp.$3),r=0;if(e<5)r=(s.firstWeek>a?7:0)+7*(e-1)+a-s.firstWeek;else{e-=5;var o=(s.firstWeek+s.length-1)%7;r=s.length-o-7*e+a-(o<a?7:0)-1}s.attrs.holiday[i+"-"+(r+1)]=RegExp.$5}}),{month:A,data:S,jieqi:u,lunarFestival:M,solarFestival:this.attrs.holiday[i+"-"+e]}},t.prototype._getSolarTermAccumulateDate=function(t,e){return Math.floor(365.242*t+6.2+15.22*e-1.9*Math.sin(.262*e))},t.prototype._gregorianCalendarToAccumulateDate=function(t,e,a){console.log("公历转化为积日",t,e,a);var r=0;r+=365*(t-1900),r+=Math.floor((t-1901)/4);for(var o=e-1;0<o;o--)r+=new Date(t,o,0).getDate(),console.log("-----------",r);return"2020,10"==[t,e].toString()&&a++,r+=a},t.prototype._getLunarDate=function(t){for(var e=Math.floor((t-1.6)/29.5306)-1,a=0;e++,30<=(a=t-Math.floor(1.6+29.5306*e+.4*Math.sin(1-.45058*e))+1););return 0===a?30:a},t});
